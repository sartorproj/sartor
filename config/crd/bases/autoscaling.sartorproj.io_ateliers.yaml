---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.19.0
  name: ateliers.autoscaling.sartorproj.io
spec:
  group: autoscaling.sartorproj.io
  names:
    kind: Atelier
    listKind: AtelierList
    plural: ateliers
    singular: atelier
  scope: Cluster
  versions:
  - additionalPrinterColumns:
    - jsonPath: .status.prometheusConnected
      name: Prometheus
      type: boolean
    - jsonPath: .status.gitProviderConnected
      name: Git
      type: boolean
    - jsonPath: .status.managedTailorings
      name: Tailorings
      type: integer
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: |-
          Atelier is the Schema for the ateliers API.
          It is cluster-scoped and defines the global configuration for Sartor.
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: Spec defines the desired state of Atelier.
            properties:
              argocd:
                description: ArgoCD defines ArgoCD integration settings.
                properties:
                  enabled:
                    default: false
                    description: Enabled enables ArgoCD integration.
                    type: boolean
                  hardRefresh:
                    default: false
                    description: |-
                      HardRefresh uses hard refresh instead of normal refresh.
                      Hard refresh clears the cache and performs a full resync.
                    type: boolean
                  insecureSkipVerify:
                    description: InsecureSkipVerify skips TLS certificate verification.
                    type: boolean
                  namespace:
                    default: argocd
                    description: Namespace is the namespace where ArgoCD Applications
                      are deployed.
                    type: string
                  refreshOnPRCreate:
                    default: false
                    description: |-
                      RefreshOnPRCreate triggers an ArgoCD refresh when a PR is created.
                      This helps ArgoCD detect the new branch.
                    type: boolean
                  secretRef:
                    description: |-
                      SecretRef references a Secret containing ArgoCD credentials.
                      The Secret should contain a 'token' key with an ArgoCD API token.
                      Only needed if ServerURL is set.
                    properties:
                      name:
                        description: name is unique within a namespace to reference
                          a secret resource.
                        type: string
                      namespace:
                        description: namespace defines the space within which the
                          secret name must be unique.
                        type: string
                    type: object
                    x-kubernetes-map-type: atomic
                  serverURL:
                    description: |-
                      ServerURL is the ArgoCD server URL (e.g., "https://argocd.example.com").
                      If not set, Sartor will use the Kubernetes API to interact with ArgoCD.
                    type: string
                  syncOnMerge:
                    default: true
                    description: SyncOnMerge triggers an ArgoCD sync when a PR is
                      merged.
                    type: boolean
                type: object
              batchMode:
                default: false
                description: BatchMode enables batching multiple changes to the same
                  repository into a single PR.
                type: boolean
              defaultAnalysisWindow:
                default: 168h
                description: DefaultAnalysisWindow is the default time window for
                  metrics analysis.
                type: string
              gitProvider:
                description: GitProvider defines the Git provider connection settings.
                properties:
                  baseURL:
                    description: |-
                      BaseURL is the base URL for self-hosted Git providers.
                      Leave empty for cloud-hosted providers.
                    type: string
                  secretRef:
                    description: |-
                      SecretRef references a Secret containing Git provider credentials.
                      The Secret should contain a 'token' key with a personal access token.
                    properties:
                      name:
                        description: name is unique within a namespace to reference
                          a secret resource.
                        type: string
                      namespace:
                        description: namespace defines the space within which the
                          secret name must be unique.
                        type: string
                    type: object
                    x-kubernetes-map-type: atomic
                  type:
                    description: Type is the Git provider type (github, gitlab, bitbucket).
                    enum:
                    - github
                    - gitlab
                    - bitbucket
                    type: string
                required:
                - secretRef
                - type
                type: object
              opencost:
                description: OpenCost defines OpenCost integration settings for cost
                  visibility.
                properties:
                  enabled:
                    default: false
                    description: Enabled enables OpenCost integration.
                    type: boolean
                  insecureSkipVerify:
                    description: InsecureSkipVerify skips TLS certificate verification.
                    type: boolean
                  url:
                    description: URL is the OpenCost server URL (e.g., "http://opencost.opencost:9003").
                    type: string
                type: object
              prSettings:
                description: PRSettings defines settings for PR creation behavior.
                properties:
                  baseBranch:
                    default: main
                    description: BaseBranch is the default base branch for PRs.
                    type: string
                  branchPrefix:
                    default: sartor/
                    description: BranchPrefix is the prefix for branches created by
                      Sartor.
                    type: string
                  cooldownPeriod:
                    default: 168h
                    description: CooldownPeriod is the minimum time between PRs for
                      the same workload.
                    type: string
                  labels:
                    description: Labels are labels to add to PRs created by Sartor.
                    items:
                      type: string
                    type: array
                  minChangePercent:
                    default: 20
                    description: MinChangePercent is the minimum percentage change
                      required to create a PR.
                    format: int32
                    maximum: 100
                    minimum: 1
                    type: integer
                type: object
              prometheus:
                description: Prometheus defines the Prometheus server connection settings.
                properties:
                  insecureSkipVerify:
                    description: InsecureSkipVerify skips TLS certificate verification.
                    type: boolean
                  secretRef:
                    description: |-
                      SecretRef references a Secret containing Prometheus authentication credentials.
                      The Secret should contain 'username' and 'password' keys for basic auth,
                      or 'token' key for bearer token authentication.
                    properties:
                      name:
                        description: name is unique within a namespace to reference
                          a secret resource.
                        type: string
                      namespace:
                        description: namespace defines the space within which the
                          secret name must be unique.
                        type: string
                    type: object
                    x-kubernetes-map-type: atomic
                  url:
                    description: URL is the Prometheus server URL.
                    pattern: ^https?://
                    type: string
                required:
                - url
                type: object
              safetyRails:
                description: SafetyRails defines minimum and maximum resource thresholds.
                properties:
                  maxCPU:
                    anyOf:
                    - type: integer
                    - type: string
                    description: MaxCPU is the maximum CPU request that Sartor will
                      recommend.
                    pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                    x-kubernetes-int-or-string: true
                  maxMemory:
                    anyOf:
                    - type: integer
                    - type: string
                    description: MaxMemory is the maximum memory request that Sartor
                      will recommend.
                    pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                    x-kubernetes-int-or-string: true
                  minCPU:
                    anyOf:
                    - type: integer
                    - type: string
                    description: MinCPU is the minimum CPU request that Sartor will
                      recommend.
                    pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                    x-kubernetes-int-or-string: true
                  minMemory:
                    anyOf:
                    - type: integer
                    - type: string
                    description: MinMemory is the minimum memory request that Sartor
                      will recommend.
                    pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                    x-kubernetes-int-or-string: true
                type: object
            required:
            - gitProvider
            - prometheus
            type: object
          status:
            description: Status defines the observed state of Atelier.
            properties:
              argoCDConnected:
                description: ArgoCDConnected indicates whether the ArgoCD connection
                  is healthy.
                type: boolean
              conditions:
                description: Conditions represent the current state of the Atelier
                  resource.
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
                x-kubernetes-list-map-keys:
                - type
                x-kubernetes-list-type: map
              gitProviderConnected:
                description: GitProviderConnected indicates whether the Git provider
                  connection is healthy.
                type: boolean
              lastArgoCDCheck:
                description: LastArgoCDCheck is the timestamp of the last ArgoCD connectivity
                  check.
                format: date-time
                type: string
              lastGitProviderCheck:
                description: LastGitProviderCheck is the timestamp of the last Git
                  provider connectivity check.
                format: date-time
                type: string
              lastOpenCostCheck:
                description: LastOpenCostCheck is the timestamp of the last OpenCost
                  connectivity check.
                format: date-time
                type: string
              lastPrometheusCheck:
                description: LastPrometheusCheck is the timestamp of the last Prometheus
                  connectivity check.
                format: date-time
                type: string
              managedTailorings:
                description: ManagedTailorings is the count of Tailoring resources
                  using this Atelier.
                format: int32
                type: integer
              openCostConnected:
                description: OpenCostConnected indicates whether the OpenCost connection
                  is healthy.
                type: boolean
              prometheusConnected:
                description: PrometheusConnected indicates whether the Prometheus
                  connection is healthy.
                type: boolean
            type: object
        required:
        - spec
        type: object
    served: true
    storage: true
    subresources:
      status: {}
